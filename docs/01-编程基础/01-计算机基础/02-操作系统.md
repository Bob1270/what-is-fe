操作系统 OS - 连接硬件和软件

# 是什么

![操作系统的位置](../../_images/操作系统的位置.png)

如上图，这个模型应该都比较清楚，操作系统就是应用软件和计算机硬件的一个中间层，它具体需要做的内容如下：

- 对上层，要管理各个应用软件
    - 管理应用程序，如限制其占用太多内存
    - 为应用程序提供服务，如 IO 网卡 声卡等
    - 杀死应用程序
- 对下层，要管理计算机的各个硬件资源，**对其主要模块做抽象**（理解这一点很重要！），本文就围绕着这三个抽象来做总结。
    - CPU 抽象为进程、线程，以及调度
    - 物理内存抽象为逻辑内存、虚拟内存，并给各个应用程序提供独立的内存空间
    - 硬盘抽象为文件系统，通过文件即可管理硬盘的数据

操作系统的主要特点有：

- 并发：通过调度算法，让多个进程都能同时执行
- 共享：当多个进程同时访问同一数据时，进行管理（同时共享 或者 互斥共享）
- 虚拟：把硬件抽象，让每个应用程序都感觉自己是独占一台计算机，即把一台物理机器虚拟成多台机器

# 重要内容

操作系统最重要的就是对于硬件的抽象，即上文讲的对于 CPU、内存和硬盘的抽象。如有遗漏，欢迎各位[继续补充](https://github.com/wangfupeng1988/what-is-fe)。

## 进程、线程和调度算法

操作系统对于 CPU 的抽象。

### 进程

进程，一个具有独立功能的程序在一个数据集合上动态执行的过程。一段代码编译出一个执行文件（在硬盘中），然后加载到内存中来执行，这个动态的执行过程就是进程。

PS：进程和我们日常所见的应用程序，并不是对等关系，如打开 chrome 会开启多个进程。

进程是操作系统管理的最小单元，操作系统会分配 CPU 资源，独立的内存资源（但一个进程被允许的最大可用内存空间是有限的）。而且操作系统会对多个进程分开管理，互不冲突，互不侵犯。

### 线程

进程，开启之后由操作系统管理。

如果需要并发操作，是否一定需要开启多个进程呢？其实没必要。而且开启多个进程，会有以下问题：

- 如何共享数据，因为不同进程的数据是独立的（进程内存独立，互不侵犯）
- 维护进程的开销很大，PCB 包含了很多信息
- 进程切换，保存、恢复信息，开销也很大

进程内部，如果想要进行并发操作，就需要使用线程。线程也是操作系统提供的能力，但是并不会由操作系统直接管理，而是由进程内部的程序来管理，如用 java 开启多线程。

- 一个进程中的多个线程共同拥有内存空间（因此数据同步简单，不会受到 os 的干预）和代码
- 不同线程可以执行不同程序代码，有不同的堆、栈、寄存器，可并发执行
- 线程在进程内部，os 管理的是进程，却管不着线程，因此进程内部的线程要自己管理自己

不过线程也有不好的一面，因为多个线程共用一段内存空间，一旦一个线程崩溃出错，极有可能影响其他线程。

这就是为何 Chrome 为每一个网页都创建一个进程、而不是线程，因为你不能信任一个网页的稳定性，一旦一个网页奔溃，其他网页别受影响。当然，这还是得基于现代计算机内存空间和 CPU 性能的支持。

### 调度算法

操作系统可以并发执行多个进程，如何保证多个进程都能正常有序的运行呢？并且 CPU 计算能力是有限的，但用户要开启的进程却不可限制。这就需要调度算法，来合理分配 CPU 在各个进程上的计算资源。

调度算法是 os 管理进程的核心算法，也是 os 是否强大的一个体现。这部分内容非常复杂，我们不用深入，了解个大概即可。

调度算法有：

- 先来先服务算法
- 短进程优先算法
- 最高响应比优先算法
- 轮询算法
- 多级反馈队列算法
- 等等……

## 内存管理

你买了一个电脑，硬件配置是 4G 内存的。电脑启动起来之后，打开 chrome ，该进程最多可以占 2G 内存。再打开一个游戏，该进程最多也可以占 2G 内存。操作系统本身还占一些内存空间，还有其他的例如 QQ 微信 PS 等。请思考：你这个电脑一共就 4G 内存，怎么能撑得起来那么多进程呢？—— 这就是操作系统对内存的管理。

硬件上的内存，不能直接暴露给 app 或者程序，要操作系统来管理它。所以，硬件的物理内存，就变成了操作系统的逻辑内存，然后给 app 或程序使用。试想一下，如果硬件的物理内存直接暴露给 app 和应用程序，第一会让程序开发变的非常复杂，第二内存使用乱套了，大家乱用毫无规则。

操作系统的逻辑内存，就提供便利、制定规则。特点是：

- 抽象：不关心物理，抽象为逻辑空间，编译开发者使用。
- 保护：每个进程独立地址空间，不相互破坏。微信不能去访问钉钉的内存空间。
- 共享：访问相同内存。
- 虚拟化：
    - 第一，虽然号称给 app 2G 的内存空间，但实际上是用多少给多少，而不是一下子给 2G ，否则就可能产生闲置和浪费。
    - 第二，虚拟的提供更多的内存空间，暂时不用的先放在硬盘上，再用的时候再到硬盘上去读取出来。
    - 所以上述案例，看似 4G 的内存，但可以支持很多程序同时开启。


## 文件系统和 I/O

待补充……

# 如何学习

书籍，网上有的是，大家找高分评价的来看就行了。

推荐一个视频教程[《操作系统》](https://www.bilibili.com/video/av6538245?from=search&seid=246032312215120374)（向勇、陈渝，清华大学）。时长很长，一定要静下心来慢慢的看完。